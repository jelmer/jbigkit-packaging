From: Michael van der Kolff <mvanderkolff@gmail.com>
Date: Sun, 20 Jul 2014 21:49:43 +1000
Subject: Update patches for new upstream

---
 debian/patches/allNewMainMakefile.diff | 28 ++++++++++--------------
 debian/patches/pbmtoolsMakefile.diff   | 33 +++++++++++++++-------------
 debian/patches/useLibtool.diff         | 40 ++++++++++++++++++----------------
 3 files changed, 50 insertions(+), 51 deletions(-)

diff --git a/debian/patches/allNewMainMakefile.diff b/debian/patches/allNewMainMakefile.diff
index 90fee2a..13ca2bd 100644
--- a/debian/patches/allNewMainMakefile.diff
+++ b/debian/patches/allNewMainMakefile.diff
@@ -5,29 +5,23 @@ Forwarded: no
 Upstream Makefile is barebones, and doesn't make any shared libraries.
 
 With some extra effort, this does.
+
+Refreshed for 2.1
 --- a/Makefile
 +++ b/Makefile
-@@ -11,9 +11,9 @@
- CFLAGS = $(CCFLAGS) -I../libjbig
+@@ -10,6 +10,7 @@ CFLAGS = -O2 -W -Wno-unused-result
+ export CC CFLAGS
  
- VERSION=2.0
+ VERSION=2.1
 +.PHONY: all lib pbm test clean install
  
  all: lib pbm
--	@echo "Enter 'make test' in order to start some automatic tests."
- 
- lib:
- 	(cd libjbig;  make "CC=$(CC)" "CFLAGS=$(CFLAGS)")
-@@ -30,9 +30,15 @@
- 	(cd libjbig; make clean)
- 	(cd pbmtools; make clean)
- 
--distribution: clean
--	rm -f libjbig/libjbig*.a
--	(cd ..; tar -c -v --exclude .svn -f jbigkit-$(VERSION).tar jbigkit ; \
--	  gzip -9f jbigkit-$(VERSION).tar )
--	scp ../jbigkit-$(VERSION).tar.gz slogin-serv1.cl.cam.ac.uk:public_html/download/
--	scp CHANGES slogin-serv1.cl.cam.ac.uk:public_html/jbigkit/
+ 	@echo "Enter 'make test' in order to start some automatic tests."
+@@ -42,3 +43,16 @@ distribution:
+ release:
+ 	rsync -t jbigkit-$(VERSION).tar.gz $(HOME)/public_html/download/
+ 	rsync -t jbigkit-$(VERSION)/CHANGES $(HOME)/public_html/jbigkit/
++
 +install: all
 +	install -d $(DESTDIR)/usr/lib/$(DEB_HOST_MULTIARCH)
 +	install -m 644 libjbig/.libs/*.so.*.*.* libjbig/.libs/*.a $(DESTDIR)/usr/lib/$(DEB_HOST_MULTIARCH)
diff --git a/debian/patches/pbmtoolsMakefile.diff b/debian/patches/pbmtoolsMakefile.diff
index e3bf02e..d69a88d 100644
--- a/debian/patches/pbmtoolsMakefile.diff
+++ b/debian/patches/pbmtoolsMakefile.diff
@@ -6,19 +6,19 @@ Upstream Makefile is barebones, and doesn't make any shared libraries.
 
 This corrects the pbmtools part (jbig <-> pbm tools) so that they
 use the shared libraries.
+
 --- a/pbmtools/Makefile
 +++ b/pbmtools/Makefile
-@@ -6,23 +6,25 @@
- 
+@@ -6,6 +6,7 @@ CC = gcc
  # Options for the compiler
- CFLAGS = -g -Wall -ansi -pedantic -I../libjbig # --coverage
+ CFLAGS = -g -O -W -Wall -Wno-unused-result -ansi -pedantic # --coverage
+ CPPFLAGS = -I../libjbig 
 +export LD_LIBRARY_PATH = ../libjbig/.libs
  
-+.PHONY: all test test82 test85
  .SUFFIXES: .1 .5 .txt $(SUFFIXES)
- 
- all: pbmtojbg jbgtopbm pbmtojbg85 jbgtopbm85 \
- 	pbmtojbg.txt jbgtopbm.txt pbm.txt pgm.txt
+ .PHONY: txt test test82 test85 clean
+@@ -15,30 +16,22 @@ all: pbmtojbg jbgtopbm pbmtojbg85 jbgtopbm85 txt
+ txt: pbmtojbg.txt jbgtopbm.txt pbm.txt pgm.txt
  
  pbmtojbg: pbmtojbg.o ../libjbig/libjbig.a
 -	$(CC) $(CFLAGS) -o pbmtojbg pbmtojbg.o -L../libjbig -ljbig
@@ -31,27 +31,30 @@ use the shared libraries.
 -pbmtojbg85: pbmtojbg85.o ../libjbig/libjbig85.a
 -	$(CC) $(CFLAGS) -o pbmtojbg85 pbmtojbg85.o -L../libjbig -ljbig85
 +pbmtojbg85: pbmtojbg85.o ../libjbig/libjbig.a
-+	$(CC) $(CFLAGS) -o pbmtojbg85 pbmtojbg85.o -L../libjbig/.libs -ljbig
++	$(CC) $(CFLAGS) -o pbmtojbg85 pbmtojbg85.o -L../libjbig/.libs -ljbig85
  
 -jbgtopbm85: jbgtopbm85.o ../libjbig/libjbig85.a
 -	$(CC) $(CFLAGS) -o jbgtopbm85 jbgtopbm85.o -L../libjbig -ljbig85
 +jbgtopbm85: jbgtopbm85.o ../libjbig/libjbig.a
-+	$(CC) $(CFLAGS) -o jbgtopbm85 jbgtopbm85.o -L../libjbig/.libs -ljbig
++	$(CC) $(CFLAGS) -o jbgtopbm85 jbgtopbm85.o -L../libjbig/.libs -ljbig85
  
  jbgtopbm.o: jbgtopbm.c ../libjbig/jbig.h
  pbmtojbg.o: pbmtojbg.c ../libjbig/jbig.h
-@@ -33,10 +35,6 @@
- 	../libjbig/jbig_ar.c ../libjbig/jbig_ar.h
- 	make -C ../libjbig libjbig.a
+ jbgtopbm85.o: jbgtopbm85.c ../libjbig/jbig85.h
+ pbmtojbg85.o: pbmtojbg85.c ../libjbig/jbig85.h
  
+-../libjbig/libjbig.a: ../libjbig/jbig.c ../libjbig/jbig.h \
+-	../libjbig/jbig_ar.c ../libjbig/jbig_ar.h
+-	make -C ../libjbig libjbig.a
+-
 -../libjbig/libjbig85.a: ../libjbig/jbig85.c ../libjbig/jbig85.h \
 -	../libjbig/jbig_ar.c ../libjbig/jbig_ar.h
 -	make -C ../libjbig libjbig85.a
 -
- test: test82 test85
+ analyze:
+ 	clang $(CPPFLAGS) --analyze *.c
  
- test82: pbmtojbg jbgtopbm
-@@ -91,6 +89,8 @@
+@@ -96,6 +89,8 @@ dotest2g:
  	cmp test-$(IMG).pgm ../examples/$(IMG).pgm
  
  test85: pbmtojbg jbgtopbm pbmtojbg85 jbgtopbm85 test-t82.pbm
diff --git a/debian/patches/useLibtool.diff b/debian/patches/useLibtool.diff
index 28d6a0a..bdc24d1 100644
--- a/debian/patches/useLibtool.diff
+++ b/debian/patches/useLibtool.diff
@@ -5,38 +5,39 @@ Forwarded: no
 Upstream Makefile is barebones, and doesn't make any shared libraries.
 
 This part actually builds the libraries.
+
+Refreshed for 2.1
 --- a/libjbig/Makefile
 +++ b/libjbig/Makefile
-@@ -7,29 +7,30 @@
- # Options for the compiler: A high optimization level is suggested
- CFLAGS = -g -O -Wall -ansi -pedantic # --coverage
+@@ -7,28 +7,30 @@ CC = gcc
+ CFLAGS = -g -O -W -Wall -ansi -pedantic # --coverage
  
--all: libjbig.a tstcodec tstcodec85
+ all: libjbig.a libjbig85.a tstcodec tstcodec85
 +.PHONY: all clean test
  
 -tstcodec: tstcodec.o jbig.o jbig_ar.o
+-	$(CC) $(CFLAGS) -o tstcodec tstcodec.o jbig.o jbig_ar.o
 +%.lo %.o: %.c
 +	libtool --mode=compile $(CC) $(CFLAGS) -c $<
-+
-+all: libjbig.la
-+
-+tstcodec: tstcodec.o libjbig.a
- 	$(CC) $(CFLAGS) -o tstcodec $+
  
 -tstcodec85: tstcodec85.o jbig85.o jbig_ar.o
-+tstcodec85: tstcodec85.o libjbig.a
- 	$(CC) $(CFLAGS) -o tstcodec85 $+
+-	$(CC) $(CFLAGS) -o tstcodec85 tstcodec85.o jbig85.o jbig_ar.o
++all: libjbig.la
  
 -libjbig.a: jbig.o jbig_ar.o
 -	rm -f libjbig.a
 -	ar rc libjbig.a jbig.o jbig_ar.o
 -	-ranlib libjbig.a
--
++tstcodec: tstcodec.o libjbig.a
++	$(CC) $(CFLAGS) -o tstcodec $+
+ 
 -libjbig85.a: jbig85.o jbig_ar.o
 -	rm -f libjbig85.a
 -	ar rc libjbig85.a jbig85.o jbig_ar.o
 -	-ranlib libjbig85.a
--
++tstcodec85: tstcodec85.o libjbig.a
++	$(CC) $(CFLAGS) -o tstcodec85 $+
+ 
 -jbig.o: jbig.c jbig.h jbig_ar.h
 -jbig85.o: jbig85.c jbig85.h jbig_ar.h
 -jbig_ar.o: jbig_ar.c jbig_ar.h
@@ -51,16 +52,17 @@ This part actually builds the libraries.
 +jbig.lo: jbig.c jbig.h jbig_ar.h
 +jbig85.lo: jbig85.c jbig85.h jbig_ar.h
 +jbig_ar.lo: jbig_ar.c jbig_ar.h
-+tstcodec.o: tstcodec.c libjbig.a
-+tstcodec85.o: tstcodec85.c libjbig.a
++tstcodec.o: tstcodec.c libjbig.a jbig.h
++tstcodec85.o: tstcodec85.c libjbig.a jbig85.h
  
- jbig.pot: jbig.c
- 	xgettext -o$@ -k_ \
-@@ -44,5 +45,6 @@
+ update-po: jbig.c jbig85.c Makefile
+ 	xgettext -ojbig.pot -k_ \
+@@ -50,6 +52,7 @@ t82test.pbm: tstcodec
  	./tstcodec $@
  
  clean:
--	rm -f *.{o,gcda,gcno,gcov} *~ core gmon.out dbg_d\=??.pbm t82test.pbm
+-	rm -f *.o *.gcda *.gcno *.gcov *.plist *~ core gmon.out dbg_d\=??.pbm
 +	rm -rf .libs
 +	rm -f *.gcda *.gcno *.gcov *.a *.la *.o *.lo *~ core gmon.out dbg_d\=??.pbm t82test.pbm
+ 	rm -f t82test.pbm
  	rm -f tstcodec tstcodec85
